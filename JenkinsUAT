import groovy.json.JsonSlurperClassic
def buildVersion = params.BuildVersion
pipeline {
    agent  {
        ecs {
            inheritFrom 'build-example'
        }
    }
    tools {
        maven 'Maven-3.9.6'
    }
    environment {
        githubApiKey = credentials('GithubTempToken')
        GIT_CREDENTIAL_ID = 'GitHubGlobaliPaasCreds'
    }
    stages {
        stage('Preparation') {
            steps {
                script {
                    echo "Starting"
		    echo env.BRANCH_NAME
               /*     def requestUrl = "https://api.github.com/repos/olympus/Hello-World/contents/emea-config.json?ref=Test"
                   
                    def headers = [[name:'Authorization', value:"Bearer " + githubApiKey ],
                                  [name:'X-GitHub-Api-Version', value:'2022-11-28'],
                                  [name:'Accept', value:'application/vnd.github+jsodn']]
                    def response = httpRequest customHeaders: headers,httpMode: 'GET', quiet: 'false',ignoreSslErrors: 'True', url: requestUrl,validResponseCodes: '200:450', consoleLogResponseBody : 'True'
                    def jsonData = new JsonSlurperClassic().parseText(response.content)
                    def blobUrl = jsonData.download_url
                    response = httpRequest customHeaders: headers,httpMode: 'GET', quiet: 'false',ignoreSslErrors: 'True', url: blobUrl,validResponseCodes: '200:450', consoleLogResponseBody : 'True'
                    jsonData = new JsonSlurperClassic().parseText(response.content)
                    // Passing Json config Parameter to Global Variables                   
                    env.ANYPOINT_PLATFORM_CLIENT_ID_VALUE = jsonData.pipeline_dev_parameters.ANYPOINT_PLATFORM_CLIENT_ID
                    env.ANYPOINT_PLATFORM_CLIENT_SECRET_VALUE = jsonData.pipeline_dev_parameters.ANYPOINT_PLATFORM_CLIENT_SECRET
                    env.SPLUNK_TOKEN_VALUE = jsonData.pipeline_dev_parameters.SPLUNK_TOKEN 
                    env.ENCRYPT_KEY_VALUE = jsonData.pipeline_dev_parameters.ENCRYPT_KEY                                                         
                    
                    env.SPLUNK_INDEX = jsonData.pipeline_dev_parameters.SPLUNK_INDEX
                    env.PS_NAME = jsonData.pipeline_dev_parameters.PS_NAME
                    
                    env.AZURE_TENANT_ID = jsonData.AZURE_TENANT_ID
                    env.AZURE_APP_ID = jsonData.AZURE_CLIENT_ID
                    env.AZURE_APP_SECRET = jsonData.AZURE_CLIENT_SECRET
                    env.MULE_AZURE_KEY_VAULT_NAME = jsonData.pipeline_dev_parameters.MULE_AZURE_KEY_VAULT_NAME
                    
                    env.APP_NAME = REGION + '-' + APINAME + '-' + ENVIRONMENT
                    env.CUSTOM_URL_DOMAIN_NAME = "https://" + jsonData.pipeline_dev_parameters.CUSTOM_URL_DOMAIN_NAME + '/' + APP_NAME                      
                    
                    env.ORG = jsonData.org
                    sh 'java -version'
                    sh 'mvn -version'
		    echo "Azure Tenant ID :$AZURE_TENANT_ID   Azure App ID :$AZURE_APP_ID   Azure Vault Name :$MULE_AZURE_KEY_VAULT_NAME " */

		    echo "ending"
                }
            }
        }
        
   

    }
}

